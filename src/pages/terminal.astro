---
import Layout from "../layouts/Layout.astro";
---

<Layout title="Terminal">
    <div class="screen">
        <pre data-terminal-output></pre>
    </div>
    <input type="text" data-terminal-input />
</Layout>

<script>
    (async () => {
        const wasm = import("@c0ntroller/wasm-terminal");
        const outputs = document.querySelectorAll("[data-terminal-output]") as NodeListOf<HTMLPreElement>;
        const inputs = document.querySelectorAll("[data-terminal-input]") as NodeListOf<HTMLInputElement>;
        const { default: init, Console } = await wasm;

        await init();
        const c = Console.new();

        inputs.forEach((input) => {
            input.addEventListener("keydown", (e) => {
                if (e.key === "Enter") {
                    const cmd = input.value;
                    const resp = c.execute(cmd);
                    outputs.forEach((output) => {
                        output.innerHTML += `$ ${cmd}${resp ? `\n${resp}` : ""}\n`;
                    });
                    input.value = "";
                }
            });
        });
    })()
</script>

<style lang="scss">
    .screen {
        width: 100%;
        height: 60em;
        background: #000;
        border-radius: 0.2em;
        box-shadow: 0 0 0.5em #000;
        color: #fff;
        font-family: monospace;
        padding: 10px;

        pre {
            margin: 0;
            padding: 0;
            white-space: pre-wrap;
            word-wrap: normal;
            overflow-wrap: break-word;
        }
    }

</style>